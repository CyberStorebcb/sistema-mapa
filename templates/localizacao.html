{% extends 'base.html' %}
{% block title %}Localização Semanal{% endblock %}
{% block content %}
<div class="glass-card mb-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
    <div>
      <h4 class="mb-0 text-uppercase">Localização das Equipes</h4>
      <small class="text-white-50">{{ semana_label }} • {{ mes_label }} • {{ total }} registros</small>
    </div>
    <div class="d-flex gap-2 flex-wrap">
      <div class="badge bg-info text-dark px-3 py-2">Atualizado automaticamente via Dropbox</div>
      <a class="btn btn-outline-light btn-sm" href="{{ url_for('localizacao_mapa') }}">
        <i class="fas fa-map-location-dot me-1"></i> Ver no mapa
      </a>
    </div>
  </div>
</div>
<div class="row g-3">
  {% for card in cards %}
  <div class="col-12 col-md-6 col-lg-4">
    <div class="glass-card h-100">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="text-info mb-0">{{ card.equipe }}</h5>
        <span class="badge bg-light text-dark">{{ card.projetos|length }} atividades</span>
      </div>
      <p class="text-white-50 mb-2"><i class="fas fa-map-pin me-1 text-warning"></i>{{ card.local_principal }}</p>
      <div class="timeline">
        {% for projeto in card.projetos %}
        <div class="timeline-item">
          <div class="timeline-date">{{ projeto.data }}</div>
          <div>
            <strong>{{ projeto.local }}</strong>
            <div class="text-muted small">{{ projeto.status }} • {{ projeto.periodo }}</div>
            <div class="text-muted small">{{ projeto.tipo }} • {{ projeto.supervisor }}</div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% else %}
  <div class="col-12">
    <div class="glass-card text-center">
      <i class="fas fa-circle-info fa-2x mb-2"></i>
      <p>Nenhuma programação encontrada para a semana atual.</p>
    </div>
  </div>
  {% endfor %}
</div>
<style>
  .timeline { border-left: 2px solid rgba(255,255,255,0.3); padding-left: 12px; }
  .timeline-item { position: relative; margin-bottom: 12px; }
  .timeline-item::before {
    content: '';
    position: absolute;
    left: -13px;
    top: 3px;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--loader-accent, #61dafb);
    box-shadow: 0 0 8px rgba(97, 218, 251, 0.8);
  }
  .timeline-date { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.08em; color: rgba(255,255,255,0.7); }
</style>
{% endblock %}
